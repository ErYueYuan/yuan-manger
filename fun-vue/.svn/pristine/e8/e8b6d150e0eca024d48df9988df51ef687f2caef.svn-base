<template>
  <div class="bg3">
    <div class="fun-top-panel bg7 ">
      <span
        class="mess-back "
        @click="goBack()"
      >
        <div class="cont"></div>
      </span>
      <span class="title c3 f3 dblock2 t-center ">知识库</span>
    </div>
    <div class="main-top p-fix bg7 b-radius2">
      <section class="f-flex  border-b1">
        <div class="sear-bb ">
          <div class=" new-search ns2 clearfix">
            <section class="sear-c posi2 clearfix">
              <form
                action=""
                class="input-search-form"
                id="search_from"
              >
                <van-search
                  v-model="searchval"
                  shape="round"
                  background=""
                  placeholder="请输入搜索关键词"
                  @search="onSearch"
                />
              </form>
            </section>
          </div>
        </div>
      </section>
    </div>
    <div class="main-container mar4-5 bg7 bot1 clearfix">
      <section class="tab-box3">
        <span
          class="c-p"
          v-for="(item,index) in tagList"
          :key="index"
          :class="tabnum == item.id?'active':''"
          @click="getBtn(item.name,item.id)"
        >{{item.name}}</span>
      </section>
      <section>
        <van-collapse
          v-model="activeName"
          accordion
        >
          <van-collapse-item
            v-for="(item,index) in list"
            :key="index"
            :title="index+1+'. '+item.className"
            :name="item.id"
            @click.native="getKnowledgeClassList(2,item.id)"
          >
            <van-collapse
              v-model="chiildName"
              accordion
              v-if="twolist||twolist.length == 0"
            >
              <van-collapse-item
                v-for="(item,index) in twolist"
                :key="index"
                :title="index+1+'. '+item.className"
                :name="item.id"
                @click.native="getKnowledgeTitle(item.id)"
              >
                <van-collapse
                   v-model="sssname"
                  accordion
                  v-if="lmKnowledgeList||lmKnowledgeList.length == 0"
                >
                  <van-collapse-item
                    v-for="(item,index) in lmKnowledgeList"
                    :key="index"
                    :title="index+1+'. '+item.title"
                    :name="item.knowledgeId"
                    @click.native="$router.push({path:'/repositorydetails/'+item.knowledgeId})"
                  >
                  </van-collapse-item>
                </van-collapse>
              </van-collapse-item>
            </van-collapse>
          </van-collapse-item>
        </van-collapse>
      </section>
    </div>
    <!-- <div class="t-center f3 c6 pad6">未找到答案？<span class="c8">去提问</span></div> -->
  </div>
</template>

<script>
import Vue from 'vue'
import { mapGetters } from 'vuex'
import { api_my } from '@/api/index'
import * as tool from '@/common/Tool'
import { Collapse, CollapseItem, Search, Button } from 'vant';

Vue.use(Collapse);
Vue.use(Button);
Vue.use(CollapseItem);
Vue.use(Search);
export default {
  data() {
    return {
      tabnum: 1,
      searchval: '',
      activeName: '1',
      chiildName: '1',
      chiildwName: '1',
      list: [],
      tagList: [],
      lmKnowledgeList: [],
      twolist: [],
      sssname:'1'
    }
  },
  computed: {
    ...mapGetters(['user']),
  },
  created() {
    this.getKnowledgeClassList(1, 0);
    this.getDefaultLabelList();
  },
  methods: {
    goBack() {
      this.$router.go(-1)
    },
    chag(val) {
      console.log(val);
    },
    getBtn(name, id) {
      this.tabnum = id;
      this.searchval = name;
    },
    getKnowledgeClassList(val, id) {
      let _data = {
        "platformId": "f2ce8561055a40d5a5e7dcdffde1e8bc",
        "saasId": this.user.userInfo.saasId,
        "classLevel": val,
        "parentId": id
      }
      api_my.getKnowledgeClassList(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          val == 1 ? this.list = res.knowledgeClassList : this.twolist = res.knowledgeClassList
        } else {
          tool.toastMessage(res.message, 'error');

        }
      })
    },
    getKnowledgeTitle(id) {
      let _data = {
        "platformId": "f2ce8561055a40d5a5e7dcdffde1e8bc",
        "saasId": this.user.userInfo.saasId,
        "classId": id
      }
      api_my.getKnowledgeTitle(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.lmKnowledgeList = res.lmKnowledgeList
        } else {
          tool.toastMessage(res.message, 'error');
        }
      })
    },
    getDefaultLabelList() {
      let _data = {
        saasId: "ff5a67337b6611e89feafa163eb3e537"
      }
      api_my.getDefaultLabelList(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.tagList = res.lmKnowledgeDefaultLabelList
        } else {
          tool.toastMessage(res.message, 'error');
        }
      })
    },
    getKnowledgeListByLabel() {
      let _data = {
        "platformId": "2724341dfdc5463cbf167f1195da6e3e",
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "offset": 0,
        "limit": 10,
        "search": this.searchval,
        "comcode": 50010,
      }
      api_my.getKnowledgeListByLabel(_data).then(res => {
         if(res.status == tool.rtCode.status){
           this.list = res.knowledgeExpList
         }else {
           tool.toastMessage(res.message,'error');
         }
      })
    },
    onSearch() {
      this.getKnowledgeListByLabel();
    }
  },
}
</script>

<style>
</style>