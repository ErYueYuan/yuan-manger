<template>
  <div class="bg7">
    <div class="fun-top-panel bg7 border-b1 ">
      <span class="mess-back " @click="$router.go(-1)"><div class="cont"></div></span>
      <span class="title c33 f4 dblock2 t-center ">注册</span>
    </div>
    <div class="main-container no-bot clearfix ">
      <div class="login-box clearfix">
        <div class="log-logo" title="logo"><img src="@/assets/img/logo.png" /></div>
        <section class="login-info-box reg">
          <div class="login-input mar29 ">
            <span class="f3 c5">手机号码</span>
            <input placeholder="请输入手机号" id="mobile" class="f3-1" type="text" v-model="registerCredential.mobile">
          </div>
          <div class="login-input posi2">
            <span class="f3 c5">验证码</span>
            <input placeholder="请输入验证码"  class="f3-1"  type="text" v-model="registerCredential.checkCode">
            <b class="ek-btn-4 po1 c-p" @click="getCheckCode">获取验证码</b>
          </div>
          <div class="login-input posi2">
            <span class="f3 c5">密码</span>
            <input placeholder="请输入密码" id="password" class="f3-1" :type="passwordType ? 'password' : ''" v-model="registerCredential.password">
            <div class="c-p" :class="passwordType ? 'show-it' : 'hidden'" :title="passwordType ? '显示' : '隐藏'" @click="passwordType=!passwordType"></div>
            <!--<div class="show-it c-p" title="显示"></div>-->
          </div>
        </section>

      </div>
      <div class="pad5-1">
        <button type="button" class="hx-bt3 t-center" @click.stop.prevent="handleRegister">注册</button>
        <div class="mar3-1 clearfix">
          <label class="f2 reg-check1 posi2 clearfix">
            <input type="checkbox" v-model="check"><b></b>
            <span class="f-left t-left">确认注册表示您已阅读同意Fun掌柜的 <i class="c111">注册服务协议</i> 和 <i class="c111">隐私政策</i></span>
          </label>
        </div>
      </div>
    </div>
    <graph-code v-if="graphCodeStatus"
                @handleCode="handleCodeCb"></graph-code>
  </div>
</template>

<script>
  import '@/assets/css/login.css'
  import {api_user} from '@/api/index'
  import * as tool from '@/common/Tool'
  import Vd from '@/common/Validator'
  import { GraphCode } from '@/components/index'

  export default {
    name: "Register",
    data () {
      return {
        registerCredential: {
          mobile: '',
          password: '',
          checkCode: ''
        },
        getCount: 0,
        passwordType: true,
        check: false,
        graphCodeStatus: false
      }
    },
    components: {
      'graph-code': GraphCode
    },
    methods: {
      handleRegister () {
        if ( Vd.required(this.registerCredential.mobile, '请输入注册手机号')
          && Vd.mobile(this.registerCredential.mobile, '请输入正确格式手机号')
          && Vd.required(this.registerCredential.checkCode, '请输入验证码')
          && Vd.mobileCode(this.registerCredential.checkCode, '请输入正确格式验证码')
          && Vd.required(this.registerCredential.password, '请输入密码')
          && Vd.password(this.registerCredential.password, '请输入6-18位密码')) {
          if (!this.check) {
            return tool.toastMessage('请同意并勾选掌柜协议', 'error')
          }
          const _data = {
            checkCode: this.registerCredential.checkCode,
            uChannelRegister: {
              platformCode: tool.app.platformCode,
              bodyType: '1',
              mobile: this.registerCredential.mobile,
              password: this.registerCredential.password
            }
          }
          api_user.register(_data).then(data => {
            if (data.status == tool.rtCode.status) {
              tool.toastMessage('恭喜您，注册成功，请去登陆吧~')
              this.$router.push({path: '/login'})
            } else {
              tool.toastMessage(data.message, 'error')
            }
          })
        }
      },
      getCheckCode () {
        this.getCount += 1
        if (this.getCount > 5) {
          this.graphCodeStatus = true
        }
      },
      handleCodeCb () {
        this.getCount = 0
        this.graphCodeStatus = false
      }
    }
  }
</script>

<style scoped>

</style>
