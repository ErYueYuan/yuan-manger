<template>
  <div>
    <div class="fun-top-panel bg7">
      <span
        class="mess-back "
        @click="goBack()"
      >
        <div class="cont"></div>
      </span>
      <span class="title c3 f3 dblock2 t-center">待续费客户</span>
    </div>
    <div class="nav-bar bg7 border-t2 b-radius2">
      <div class="t-center">
        <span
          class="f3-1"
          :class="flag==1?'active':''"
          @click="changeState(1)"
        >待续费客户</span>
      </div>
      <div class="  t-center">
        <span
          class="f3-1"
          :class="flag==2?'active':''"
          @click="changeState(2)"
        >保单失效客户</span>
      </div>
    </div>
    <div
      class="main-container mar4-1 clearfix"
      v-if="flag==1"
    >
      <!-- <van-list
      v-model="loading"
      :finished="finished"
      :immediate-check="false"
      finished-text="没有更多了"
      @load="onLoad"
    >
    </van-list> -->
      <section
        class="b-radius3 mar3-6 pad1-3 bg7 clearfix"
        v-for="(item,index) in donelist"
        :key="index"
      >
        <div class="blk-cont-box posi2">
          <div class="img-box ib1 posi2">
            <img src="../../assets/img/index/bar_bg.png">
            <!-- <img :src="item[0].headUrl"> -->
          </div>
          <div class="right-box rb2 posi2  c-p">
            <h3 class="f2 c6 mar7-2">{{item[0].name}}</h3>
            <section
              class="mar3-2 posi2 pad6-3 border-t"
              v-for="(childitem,indexs) in item"
              :key="indexs"
              @click="$router.push({ path: '/dealDetails/' + user.userInfo.agentcode + '/'+childitem.policyNo })"
            >
              <div class="icon-num t-center" style="line-height:29px;">{{indexs}}</div>
              <div class=" f2 c4 ">
                <span>待续费保单：</span><span>{{childitem.policyNo}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>产品：</span><span>{{childitem.productName}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>续费类型：</span><span class="c8">{{childitem.type}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>续费日期：</span><span class="c8">{{childitem.date}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>保单年度：</span><span>{{childitem.year}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>续费金额：</span><span>{{childitem.premium}}元</span>
              </div>
            </section>
          </div>
          <b class="flag2 f1 c4">待续费保单{{item.length}}张</b>
        </div>
      </section>
    </div>
    <div
      class="main-container mar4-1 clearfix"
      v-else-if="flag==2"
    >
      <section
        class="b-radius3 mar3-6 pad1-3 bg7 clearfix"
        v-for="(item,index) in donelist"
        :key="index"
      >
        <div class="blk-cont-box posi2">
          <div class="img-box ib1 posi2">
            <img src="../../assets/img/index/bar_bg.png">
            <!-- <img :src="item[0].headUrl"> -->
          </div>
          <div class="right-box rb2 posi2  c-p">
            <h3 class="f2 c6 mar7-2">{{item[0].name}}</h3>
            <section
              class="mar3-2 posi2 pad6-3 border-t"
              v-for="(childitem,indexs) in item"
              :key="indexs"
            >
              <div class="icon-num t-center" style="line-heigth:29px;">{{indexs}}</div>
              <div class=" f2 c4 ">
                <span>失效保单：</span><span>{{childitem.policyNo}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>产品：</span><span>{{childitem.productName}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>失效日期：</span><span class="c8">{{childitem.invaliddate}}</span>
              </div>
              <div class=" f2 c4 ">
                <span>失效原因：</span>{{polstates(item.invalidReason)}}<span>{{name}}</span>
              </div>
            </section>
          </div>
          <b class="flag2 f1 c4">失效保单{{item.length}}张</b>
        </div>
      </section>
    </div>
  </div>
</template>

<script>
import Vue from 'vue'
import { api_my, api_sell } from '@/api/index'
import { mapGetters } from 'vuex'
import * as tool from '@/common/Tool'
import { List } from 'vant'
Vue.use(List)
export default {
  name: 'achieveclient',
  data() {
    return {
      donelist: [],
      flag: 1,
      limit: 10,
      offset: 0,
      total: 0,
      loading: false,
      finished: false,
      polstateList:[],
      name:'',
    }
  },
  computed: {
    ...mapGetters(['user'])
  },
  created() {
    this.getFunRenewCustomer();
  },
  beforeCreate: function () {
    document.getElementsByTagName("body")[0].className = "bg3";
  },
  mounted() {
  },
  methods: {
    changeState(val) {
      this.flag = val;
      this.getFunRenewCustomer();
    },
    goBack() {
      this.$router.go(-1);
    },
    polstates(val) {
      const _data = { type: 'cbs_cont_polstate/' + tool.app.platformCode + '/' + tool.app.saasId }
      api_sell.sysDict(_data).then(data => {
        if (data.status == tool.rtCode.status) {
             data.params.dicts.forEach(item=>{
                if(item.value == val){
                  this.name = item.name
                }
             })
        } else {
          tool.toastMessage(data.message, 'error');
        }
      })
    },
    getFunRenewCustomer() {
      let _data = {
        "agentCode": 9999,
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "flag": this.flag,
        "offset": this.offset,
        "limit": this.limit
      }
      if (this.flag == 1) {
        _data.agentCode = 9999
      } else {
        _data.agentCode = 9998
      }
      api_my.getFunRenewCustomer(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.donelist = res.result;
        }else{
          tool.toastMessage(res.message, 'error');

        }
      })
    },
  }
}
</script>

<style>
</style>
