<template>
  <div class="bg3">
    <div class="fun-top-panel bg-my  ">
      <span
        class="mess-back "
        @click="goBack()"
      >
        <div class="cont-wh"></div>
      </span>
      <span class="title c7 f3 dblock2 t-center ">全部客户</span>
      <span class="right"><b
          class="fun-icon icon-search"
          @click="$router.push({path:'/searchclient'})"
        ></b></span>
    </div>
    <div class="main-container mar3-7 clearfix">
      <div class="my-n-txtbox pd1">
        <section class="my2020-nav-top  mnt1 bg7 ">
          <ul class=" f2 row mar0">
            <li class="col-4 pad1-1 none t-center bor-b">
              <b class="f3 c5">{{allNum}}<span class="f1 c4">人</span></b>
              <div class="t-center f2 c4">全部客户</div>
            </li>
            <li class="col-4 pad1-1 none t-center bor-b">
              <b class="f3 c5">{{orderNum}}<span class="f1 c4">人</span></b>
              <div class="t-center f2 c4">订单客户</div>
            </li>
            <li class="col-4 pad1-1 t-center none bor-b">
              <b class="f3 c5">{{dealNum}}<span class="f1 c4">人</span></b>
              <div class="t-center f2 c4">成交客户</div>
            </li>
            <li class="col-4 pad1-1 t-center none">
              <b class="f3 c5">{{officialNum}}<span class="f1 c4">人</span></b>
              <div class="t-center f2 c4">加公众号</div>
            </li>
            <li class="col-4 pad1-1 none t-center ">
              <b class="f3 c5">{{wechatNum}}人</b>
              <div class="t-center f2 c4">加微信</div>
            </li>
            <li class="col-4 pad1-1 none t-center none">
              <b class="f3 c5">{{adviserNum}}<span class="f1 c4">人</span></b>
              <div class="t-center f2 c4">已绑定顾问</div>
            </li>
          </ul>
        </section>

        <div class="main-top mar3-9 bg7 ">
          <div class="sale-nav row mar6-6 pad6">
            <div class="col-6 pad8" @click="$router.push({path:'/achieveclient'})">
              <div class="sale-btn-l2 t-left">
                <div class="pad5-3">
                  <h3 class="f4 c7">成交客户</h3>
                  <p class="c7 f1">本月有{{renewNum}}位待续费客户</p>
                </div>
              </div>
            </div>
            <div class="col-6 pad8">
              <div class="sale-btn-r2 t-left">
                <div class="pad5-3">
                  <h3 class="f4 c7">客户关怀</h3>
                  <p class="c7 f1">近7天生日客户 {{careNum}}位</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <section
        class="bg7 b-radius1 mar3-2"
        style="position:relative;"
      >
        <div
          class="box"
          style="width:90%;"
        >
          <van-dropdown-menu>
            <van-dropdown-item
              @change="changeMenu"
              @open="menutype=1"
              v-model="value1"
              :options="option1"
            />
            <van-dropdown-item
              @change="changeMenu"
              @open="menutype=2"
              v-model="value2"
              :options="option2"
            />
            <van-dropdown-item
              @change="changeMenu"
              @open="menutype=3"
              v-model="value3"
              :options="option3"
            />
            <van-dropdown-item
              @change="changeMenu"
              @open="menutype=4"
              v-model="value4"
              :options="option4"
            />
          </van-dropdown-menu>
        </div>
        <div
          class=" fresh  border-t2 clearfix"
          style="position:absolute;right:0;top:0;"
        >
          <div>
            <b
              class="fun-icon icon-select mar3-2"
              title="筛选"
              @click="show = true"
            ></b>
          </div>
        </div>
        <van-popup
          v-model="show"
          round
          position="bottom"
          :style="{ height: '70%'}"
        >
          <!-- <div class="mask-layer"></div> -->
          <div class="pb1 pad5">
            <div class="c5 f2-1">客户需求</div>
            <div class="sel-b3">
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
            </div>
            <div class="c5 f2-1">客户能力</div>
            <div class="sel-b3">
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
            </div>
            <div class="c5 f2-1">客户意愿</div>
            <div class="sel-b3">
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
              <label>
                <input type="checkbox"><b>高</b>
              </label>
              <label>
                <input type="checkbox"><b>已婚无子</b>
              </label>
            </div>
            <div class="c5 f2-1">创建时间</div>
            <div class="sel-b3">
              <label>
                <input type="checkbox"><b>今日</b>
              </label>
              <label>
                <input type="checkbox"><b>7天</b>
              </label>
              <label>
                <input type="checkbox"><b>30天</b>
              </label>
            </div>
            <section class="pad5-4">
              <div class="timer-box no-t f2-1">
                <span class="f1 c5 date t-center c-p">开始日期</span>
                <span class=" c5 sp1 t-center"><b></b></span>
                <span class="f1 c5 date t-center c-p">结束日期</span>
              </div>
            </section>
            <div class="pad5-9  b1  border-t">
              <div class="reg-bt t-center">
                <button
                  type="button"
                  class="b-left"
                >重置</button><button
                  type="button"
                  class="b-right"
                >完成</button>
              </div>
            </div>
          </div>

        </van-popup>
      </section>
      <section class="bg7 border-t">
        <div
          class="blk-cont-box posi2 border-b1 mar6-2"
          v-for="(item,index) in  list"
          :key="index"
        >
          <div class="img-box posi2">
            <img src="../../assets/img/index/bar_bg.png" />
            <b class="state c-p">{{item.getSource}}</b>
          </div>
          <div class="right-box posi2  c-p">
            <h3 class="f2 c6 mar7-2">{{item.name}}
            </h3>
            <div class="f2 c4">
              <span>年龄：</span><span>{{item.age}}岁</span>
            </div>
            <div class=" f2 c4">
              <span>客户星级：</span><span class="stars-box"><i
                  v-for="(item,index) in item.customerStar"
                  :key="index"
                ></i></span>
            </div>
            <div class=" f2 c4">
              <span>订单状态：</span><span class="c8">{{item.orderStatus}}</span>
            </div>
            <div class=" f2 c4">
              <span>订单更新时间：</span><span>{{item.date}}</span>
            </div>
            <div class="f1"><b class="ek-btn-5" >{{item.activitySource}}</b></div>
          </div>
          <b
            class="flag"
            @click="goDetail(item.clientId,item.clientNewId)"
          >客户行销</b>
        </div>
      </section>
    </div>

  </div>
</template>

<script>
import { api_my } from '@/api/index'
import { mapGetters } from 'vuex'
import * as tool from '@/common/Tool'
import Vue from 'vue'
import '@vant/touch-emulator'
import {
  Popup, DropdownMenu, DropdownItem,
  Field, Picker, Overlay
} from 'vant';
Vue.use(Picker)
Vue.use(Overlay)
Vue.use(Popup)
Vue.use(Field)
Vue.use(DropdownMenu);
Vue.use(DropdownItem);
export default {
  data() {
    return {
      show: false,
      menutype:'',
      value1: '',
      value2: '',
      value3: '',
      value4: '',
      // 1:待跟进；2：跟进中；3：计划跟进；4：待成交 5：被拉黑 ；6：已成交 ；7：已放弃
      option1: [
        { text: '行销状态', value: '' },
        { text: '待跟进', value: 1 },
        { text: '跟进中', value: 2 },
        { text: '计划跟进', value: 3 },
        { text: '待成交', value: 4 },
        { text: '被拉黑', value: 5 },
        { text: '已成交', value: 6 },
        { text: '已放弃', value: 7 },
      ],
      // 1-系统分配;2-主动取数;3-自建客户
      option2: [
        { text: '客户类型', value: '' },
        { text: '系统分配', value: 1 },
        { text: '主动取数', value: 2 },
        { text: '自建客户', value: 3 },
      ],
      // 1-添加微信;2-关注公众号;3-绑定顾问
      option3: [
        { text: '客户关系', value: '' },
        { text: '添加微信', value: 1 },
        { text: '关注公众号', value: 2 },
        { text: '绑定顾问', value: 3 },
      ],
      // 1-时间顺序 2-质量顺序
      option4: [
        { text: '排序', value: '' },
        { text: '时间顺序', value: 1 },
        { text: '质量顺序', value: 2 },
      ],
      list: [],
      adviserNum: '',
      allNum: '',
      careNum: '',
      dealNum: '',
      officialNum: '',
      orderNum: '',
      renewNum: '',
      wechatNum: '',
      customerStatus: '',
      customerType: '',
      customerRelation: '',
      sort: '',
    }
  },
  computed: {
    ...mapGetters(['user'])
  },
  created() {
    this.getCustomerSearchList();
    this.getCustomerCount();
  },
  mounted() {
  },
  methods: {
    goBack() {
      this.$router.go(-1);
    },
    goDetail(clientId, clientNewId) {
      this.$router.push({ path: '/customerDetail/' + clientId + '/' + clientNewId });
    },
    getCustomerCount() {
      let _data = {
        "name": "狗剩",
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "offset": 0,
        "startdate": "2020-09-01",
        "enddate": "2020-09-07",
        "limit": 10,
        "customerStatus": 1,
        "customerType": 1,
        "agentUserId": "0003660579e611e9a021246e965b5bf8",
        "customerRelation": 1,
        "sort": 1
      }
      api_my.getCustomerCount(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.adviserNum = res.adviserNum
          this.allNum = res.allNum
          this.careNum = res.careNum
          this.dealNum = res.dealNum
          this.officialNum = res.officialNum
          this.orderNum = res.orderNum
          this.renewNum = res.renewNum
          this.wechatNum = res.wechatNum
        } else {
          tool.toastMessage(res.message, 'error')
        }
      })
    },
    getCustomerSearchList() {
      // let _data ={
      //   saasId:this.user.userInfo.saasId,
      //   offset:0,
      //   limit:10,
      //   agentUserId:this.user.userInfo.userId
      // }
      let _data = {
        "name": "狗剩",
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "offset": 0,
        "startdate": "2020-09-01",
        "enddate": "2020-09-07",
        "limit": 10,
        "customerStatus": this.customerStatus,
        "customerType": this.customerType,
        "agentUserId": "0003660579e611e9a021246e965b5bf8",
        "customerRelation": this.customerRelation,
        "sort": this.sort
      }
      api_my.getCustomerSearchList(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.list = res.result;
        } else {
          tool.toastMessage(res.message, 'error')
        }
      })
    },
    changeMenu(i) {
      switch (this.menutype) {
        case 1:
          this.customerStatus = i;
          break;
        case 2:
          this.customerType = i;
          break;
        case 3:
          this.customerRelation = i;
          break;
        case 4:
          this.sort = i;
          break;
      }
      this.getCustomerSearchList();
    }
  },

}
</script>

<style>
</style>
