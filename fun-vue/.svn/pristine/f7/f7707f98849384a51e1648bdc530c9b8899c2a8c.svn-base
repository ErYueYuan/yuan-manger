<template>
  <div>
    <div class="fun-top-panel" @click="goBack()">
      <span class="mess-back "><div class="cont-wh"></div></span>
      <span class="title c7 f4 dblock2 t-center ">客户画像</span>
    </div>
    <div class="portrayal-top ">
      <div class="sex posi2" v-if="customerSex == '1'"><img src="../../assets/img/hx/male.png" /></div><!--男士-->
      <div class="sex posi2" v-if="customerSex == '0'"><img src="../../assets/img/hx/famale.png" /></div><!--女士-->
      <div class="sex posi2" v-if="customerSex == '2' || customerSex == null"><img src="../../assets/img/hx/male.png" /></div><!--未知，图暂未提供，暂显示男-->
      <div class="tab-self">
        <!-- 来自大数据的标签 -->
        <div class="tab f1 c7 o-p4 clearfix" v-for="(item, index) in bigDataList" :key="index + 'PP'">
          <span class="f-left">{{item.ltext}}</span>
          <span class="f-right">{{item.rtext}}</span>
        </div>
        <!-- 来自fun的自定义及系统的标签 -->
        <div class="tab f1 c7 o-p4 clearfix" v-for="(item, index) in funThirdTags" :key="index">
          <span class="f-left c12" v-if="index%2==0">{{item}}</span>
          <span class="f-right c12" v-if="index%2!=0">{{item}}</span>
        </div>
      </div>
      <div class="t-center c7 f2-1 info">{{customerSex == '0' ? '女' : (customerSex == '1' ? '男' : '未知')}} /
        {{customerAge}}岁
      </div>
    </div>

    <section class=" pad1-3 bg7 b-radius1 fun-info-b2">
      <section class="clearfix" v-for="(item, index) in funBigDataCustomerTagsDTOList" :key="index">
        <h3 class="portrayal-tit1  mar3-6  pt1">{{item.firstName}}</h3>
        <section class="hx-tag clearfix">
          <div class="f-left mar5-1" v-for="(item2, index) in item.secondTagsName" :key="index">
            <span>{{item2}}</span>
          </div>
        </section>
      </section>

    </section>
  </div>
</template>
<script>
  import Vue from 'vue'
  import { mapGetters } from 'vuex'
  import * as tool from '@/common/Tool'
  import { api_sell } from '@/api/index'
  import DataSource from '@/common/DataSource'
  import '@vant/touch-emulator'

  export default {
    name: 'portraitDetail',
    data() {
      return {
        clientNewId: this.$route.params.q,
        resultId: this.$route.params.r,
        customerSex: '',
        customerAge: '',
        // funCustomerFirstPortraitDTOList: [],
        // secondLabelList: [],
        // tagsName: '',
        // newTagList: [],
        funBigDataCustomerTagsDTOList: [],
        bigDataList: [],//大数据标签
        funThirdTags: [],//三级标签
      }
    },
    computed: {
      ...mapGetters(['user']),
    },
    components: {},
    beforeCreate: function () {
      document.getElementsByTagName('body')[0].className = 'fun-top-zhx'
    },
    created() {
      this.queryCustomerPortrait()
      this.queryCustomerPortraitDetail()
    },
    methods: {
      queryCustomerPortrait() {
        const _data = {
          saasId: tool.app.saasId,
          resultId: this.resultId
        }
        api_sell.queryCustomerPortrait(_data).then(data => {
          if (data.status == tool.rtCode.status) {
            this.customerSex = data.sex
            this.customerAge = data.age
            // this.tagsName = data.tagsName

            // for (let i in this.tagsName) {
            //   this.newTagList.push({ rightTxt: this.tagsName[i] })
            // }
          } else {
            tool.toastMessage(data.message, 'error')
          }
        })
      },

      queryCustomerPortraitDetail () {
        const _data = {
          saasId: tool.app.saasId,
          clientNewId: this.clientNewId
        }
        api_sell.queryCustomerPortraitDetail(_data).then(data => {
          if (data.status == tool.rtCode.status) {
            this.funBigDataCustomerTagsDTOList = data.funBigDataCustomerTagsDTOList;
            this.funThirdTags = data.funThirdTags;
            
            for (let f in data.funBigDataCustomerTagsDTOList) {
              // console.log('secondTagsName',data.funBigDataCustomerTagsDTOList[f].secondTagsName)
              let result = [];
              for (let i=0;i<data.funBigDataCustomerTagsDTOList[f].secondTagsName.length;i+=2) {//将数组分割成每2个一组
                result.push(data.funBigDataCustomerTagsDTOList[f].secondTagsName.slice(i, i+2));
              }
              for (let j in result) {
                this.bigDataList.push({
                  ltext: result[j][0],
                  rtext: result[j][1]
                })
              }
            }
            // console.log('bigDataList',this.bigDataList)
          }
        })
      },

      // queryCustomerPortraitDetail() {
      //   let that = this
      //   const _data = {
      //     saasId: tool.app.saasId,
      //     clientNewId: this.clientNewId
      //   }
      //   api_sell.queryCustomerPortraitDetail(_data).then(data => {
      //     if (data.status == tool.rtCode.status) {
      //       if (!!data.funCustomerFirstPortraitDTOList) {
      //         this.funCustomerFirstPortraitDTOList = data.funCustomerFirstPortraitDTOList
      //         for (let i in data.funCustomerFirstPortraitDTOList) {
      //           for (let index in data.funCustomerFirstPortraitDTOList[i].funCustomerSecondPortraitDTOList) {
      //             this.secondLabelList.push({
      //               secText: data.funCustomerFirstPortraitDTOList[i].funCustomerSecondPortraitDTOList[index].secondName
      //             })
      //             for (let ind in data.funCustomerFirstPortraitDTOList[i].funCustomerSecondPortraitDTOList[index].funCustomerThirdPortraitDTOList) {
      //               this.secondLabelList[i].tirText = data.funCustomerFirstPortraitDTOList[i].funCustomerSecondPortraitDTOList[index].funCustomerThirdPortraitDTOList[ind].thirdName
      //             }
      //           }
      //         }
      //         this.secondLabelList = this.secondLabelList.concat(this.newTagList)
      //       } else {
      //         this.secondLabelList = this.secondLabelList.concat(this.newTagList)
      //       }
      //     } else {
      //       tool.toastMessage(data.message, 'error')
      //     }
      //   })
      // },

      goBack() {
        this.$router.go(-1)
      },
    },
    beforeDestroy: function () {
      DataSource.del('messPath', 2)
      // document.body.removeAttribute("class", "fun-top-zhx");
    },
  }
</script>
<style scoped>
  html, body {
    position: relative;
    height: 100%;
  }
</style>
