<template>
    <div class="bg3">
        <div>
            <div class="main-top p-fix bg7 b-radius2" style="top: 0px;">
                <section class="f-flex pad7-1 border-b1">
                    <div class="sear-bb ">
                        <div class=" new-search ns clearfix">
                            <section class="sear-c posi2 clearfix" @click="search()">
                                <form action="" class="input-search-form" id="search_from"  >
                                    <input type="search" disabled input autocomplete="off" placeholder="输入关键字搜索" ng-model="search.text" class="f2 " >
                                </form>
                                <button class="sea-btn" ng-click="searchLike()"><span class="gg-search" ></span></button>
                            </section>
                        </div>
                    </div>
                    <div class="all-box t-center f2 c8 l-h2">全部客户</div>
                </section>
                <div class="sale-nav row mar0 pad6">
                    <div class="col-6" @click="getCustomer()"> <div class="sale-btn-l t-center"><b class="s-icon b1"></b>获取客户</div></div>
                    <div class="col-6" @click="createCustomer()"> <div class="sale-btn-r t-center"><b class="s-icon b2"></b>自建客户</div></div>
                </div>
            </div>

            <div class="main-container mar4-4 clearfix" style="margin-top: 146px;">
                <section class="bg7 b-radius2 ">
                    <div class="clearfix bg7 f-flex">
                        <div class="sel-p5 pro" :class="listStatus == 1 ? 'active' : ''" @click="chooseList(1)"><label class="f3-1"><b>待跟进</b></label></div>
                        <div class="sel-p5 pro" :class="listStatus == 2 ? 'active' : ''" @click="chooseList(2)"><label class="f3-1"><b>跟进中</b></label></div>
                        <div class="sel-p5 pro" :class="listStatus == 3 ? 'active' : ''" @click="chooseList(3)"><label class="f3-1"><b>计划跟进</b></label></div>
                        <div class="sel-p5 pro" :class="listStatus == 4 ? 'active' : ''" @click="chooseList(4)"><label class="f3-1"><b>待成交</b></label></div>
                    </div>
                    <div class="bg7 fresh  border-t2 clearfix b-radius2" style="height: auto;">
                        <div style="height: 58px;border-top: 1px solid #F5F5F5;border-radius: 0 0 8px 8px;background-color: #fff;padding: 10px 15px;line-height: 35px;display: flex;justify-content: space-between;">
                            <div class="cont sel-box2 abc" :class="labelStatus == 1 ? 'abc_selected' : ''" @click="selectClick('1')">{{!labelTitle1 ? '客户类型' : labelTitle1}}</div>
                            <div class="cont sel-box2 abc" :class="labelStatus == 2 ? 'abc_selected' : ''" @click="selectClick('2')">{{!labelTitle2 ? '等级' : labelTitle2}}</div>
                            <div class="cont sel-box2 abc" :class="labelStatus == 3 ? 'abc_selected' : ''" @click="selectClick('3')" v-show="listStatus == 1 || listStatus == 4">{{!labelTitle3 ? '专案线索' : labelTitle3}}</div>
                            <div class="cont sel-box2 abc" :class="labelStatus == 4 ? 'abc_selected' : ''" @click="selectClick('4')">{{!labelTitle4 ? '排序' : labelTitle4}}</div>
                        </div>
                        <div v-show="isLabel" class="pad1"><!-- v-show="isMask" -->
                            <ul>
                                <li class="l-h3 c-p border-b1 c5 f2" v-for="(item, index) in labelList" :key="index" @click="selectContent(item.name, item.value, item.type)" >{{item.name}}</li>
                            </ul>
                        </div>
                    </div>
                </section>
                
                <section class="bg7 ">
                    <div class="blk-cont-box posi2 border-b1 mar6-2" v-for="(item, index) in customerList" :key="index">
                        <div class="img-box posi2">
                            <img src="../../assets/img/index/bar_bg.png" />
                            <b class="state c-p" v-show="item.getSource == 1">系统分配</b>
                            <b class="state c-p" v-show="item.getSource == 2">主动取数</b>
                            <b class="state c-p" v-show="item.getSource == 3">自建客户</b>
                            <b class="state c-p" v-show="item.getSource == 4">成交客户</b>
                        </div>
                        <div class="right-box posi2  c-p" >
                            <h3 class="f2 c6 mar7-2"><span>{{item.name}}</span></h3>
                            <div class="f2 c4 ">
                                <span>年龄：</span><span>{{item.age}}岁</span>
                                <b v-if="!!item.sex && item.sex == '1'" class="s-icon b3"></b>
                                <b v-if="!!item.sex && item.sex == '2'" class="s-icon b4"></b>
                            </div>
                            <div class=" f2 c4">
                                <span>客户星级：</span>
                                <span class="stars-box" v-if="item.customerStar == '1'"><i></i><i class="grey"></i><i class="grey"></i><i class="grey"></i><i class="grey"></i></span>
                                <span class="stars-box" v-if="item.customerStar == '2'"><i></i><i></i><i class="grey"></i><i class="grey"></i><i class="grey"></i></span>
                                <span class="stars-box" v-if="item.customerStar == '3'"><i></i><i></i><i></i><i class="grey"></i><i class="grey"></i></span>
                                <span class="stars-box" v-if="item.customerStar == '4'"><i></i><i></i><i></i><i></i><i class="grey"></i></span>
                                <span class="stars-box" v-if="item.customerStar == '5'"><i></i><i></i><i></i><i></i><i></i></span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 2 || listStatus === 3">
                                <span>跟进状态：</span><span>{{item.orderStatus}}</span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 4">
                                <span>订单状态：</span><span class="c8">{{item.orderStatus}}</span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 1">
                                <span>创建时间：</span><span>{{item.date}}</span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 2">
                                <span>最新互动时间：</span><span>{{item.date}}</span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 3">
                                <span>计划时间：</span><span>{{item.date}}</span>
                            </div>
                            <div class=" f2 c4" v-show="listStatus === 4">
                                <span>订单更新时间：</span><span>{{item.date}}</span>
                            </div>
                            <div class="f1"><b class="ek-btn-5" v-if="!!item.activitySource">{{item.activitySource}}</b></div>
                        </div>
                        <b class="flag" @click="goDetail(item)">客户行销</b>
                    </div>
                </section>
            </div>
        </div>


        <!-- 获取客户弹框 -->
        <div class="pop-box pb1 bg7" v-show="accessStatus">
            <div class="pad1-5">
                <div class="ek-com-tit ">取数</div>
                <section class="pad4-1">
                    <div class="f2 c5">客户登记<span class="stars-box sel"><i></i><i></i><i></i><i class="grey"></i><i class="grey"></i></span></div>
                    <section class=" falg-bg">
                        <div class="rang-box posi2">
                            <div class="l-box">
                                <b></b>
                                <p class="f1">0个</p>
                            </div>
                            <div class="r-box">
                                <b></b>
                                <p class="f1">10个</p>
                            </div>
                            <input  placeholder="0 - 100" min="0" max="100" step="1" value="50"  type="range">
                        </div>
                        <div class="btn-box"><button class=" ek-btn-1 f1 " >取数</button></div>
                    </section>
                    <div class="f1 c5">该数据成本: <span class="c8">200元/人</span><span class="c4">(取数将从余额中扣除)</span></div>
                    <div class="f1 c5">数据优势: <span class="c4">e互助二级客户，已加入防癌互助计划，可直接通
                    过公众号进行沟通</span></div>
                </section>
                <section class="pad4-1">
                    <div class="f2 c5">客户登记<span class="stars-box sel"><i></i><i></i><i></i><i class="grey"></i><i class="grey"></i></span></div>
                    <section class=" falg-bg">
                        <div class="rang-box posi2">
                            <div class="l-box">
                                <b></b>
                                <p class="f1">0个</p>
                            </div>
                            <div class="r-box">
                                <b></b>
                                <p class="f1">10个</p>
                            </div>
                            <input  placeholder="0 - 100" min="0" max="100" step="1" value="50"  type="range">
                        </div>
                        <div class="btn-box"><button class=" ek-btn-1 f1 " >取数</button></div>
                    </section>
                    <div class="f1 c5">该数据成本: <span class="c8">200元/人</span><span class="c4">(取数将从余额中扣除)</span></div>
                    <div class="f1 c5">数据优势: <span class="c4">e互助二级客户，已加入防癌互助计划，可直接通
                        过公众号进行沟通</span></div>
                </section>
                <section class="pad4-1">
                    <div class="f2 c5">客户登记<span class="stars-box sel"><i></i><i></i><i></i><i class="grey"></i><i class="grey"></i></span></div>
                    <section class="pad38-1 falg-bg">
                        <div class="rang-box posi2">
                            <div class="l-box">
                                <b></b>
                                <p class="f1">0个</p>
                            </div>
                            <div class="r-box">
                                <b></b>
                                <p class="f1">10个</p>
                            </div>
                            <input  placeholder="0 - 100" min="0" max="100" step="1" value="50"  type="range">
                        </div>
                        <div class="btn-box"><button class=" ek-btn-1 f1 " >取数</button></div>
                    </section>
                    <div class="f1 c5">该数据成本: <span class="c8">200元/人</span><span class="c4">(取数将从余额中扣除)</span></div>
                    <div class="f1 c5">数据优势: <span class="c4">e互助二级客户，已加入防癌互助计划，可直接通
                        过公众号进行沟通</span></div>
                </section>
            </div>
            <div class="close" title="关闭" @click="closeAccess()"></div>
        </div>
        <!-- end -->

        <footer-panel footer="sell"></footer-panel>
        <div class="mask-layer2" v-show="isMask" @click="closed()"></div>
    </div>
</template>
<script>
    import Vue from 'vue'
    import { mapGetters } from 'vuex'
    import { FooterPanel } from '@/components/index'
    import * as tool from '@/common/Tool'
    import { api_sell } from '@/api/index'
    import DataSource from '@/common/DataSource'
    import { Popup, Picker } from 'vant'
    // import func from '../../../vue-temp/vue-editor-bridge' //暂时没用上，先留着，后期看下不用就删掉
    // import Rules from './Rules'
    // import Works from './Works'
    // import Visitor from './Visitor'
    // import Performance from './Performance'

    Vue.use(Popup)
    Vue.use(Picker)

    export default {
        name: "SellList",
        data () {
            return {
                q: this.$route.params.q,//定位到具体的状态列表
                customerList: [],//客户列表
                listStatus: DataSource.get('listStatus', 1) ? DataSource.get('listStatus', 1) : 1,
                customerTypeList: [],//客户类型列表
                levelList: [],//等级列表
                clueList: [],//专案线索列表
                sortList: [],//排序列表
                orderList: [],//订单状态列表
                labelStatus: DataSource.get('labelStatus', 1) ? DataSource.get('labelStatus', 1) : 1,
                isLabel: false,
                isMask: false,//遮罩层
                labelList: [],
                labelTitle1: "",//筛选标签的下拉选项列表
                labelTitle2: "",
                labelTitle3: "",
                labelTitle4: "",
                labelValue1: "",//选中的筛选标签的value值
                labelValue2: "",
                labelValue3: "",
                labelValue4: "",
                accessStatus: false,



                // getSource: '1',//客户来源:1-分配客户;2-取数客户;3-自建客户
                // customerStar: '1',//客户星级:1-5级
                // purchaseIntention: "",//专案线索,this.labelValue3
                // sort: '1',//排序:1-时间顺序;2-客户等级

            }
        },
        computed: {
            ...mapGetters(['user']),
        },
        components: {
            'footer-panel': FooterPanel,
            // 'rules': Rules,
            // 'works': Works,
            // 'visitor': Visitor,
            // 'performance': Performance
        },
        created () {
            this.listStatus = this.q;
            // this.getCustomerSearchList(); // 搜索列表
            this.getCustomerList();

            //筛选标签
            this.labelType();//类型
            this.labelLevel();//等级
            this.labelClue();//方案
            this.labelSort();//排序
            this.orderStatusList();
        },
        methods: {
            chooseList (type) {
                this.listStatus = type;
                DataSource.set('listStatus', this.listStatus, 2)
                this.getCustomerList();

                // 清空筛选内容
                this.labelStatus = 1;
                this.labelTitle1 = "";
                this.labelTitle2 = "";
                this.labelTitle3 = "";
                this.labelTitle4 = "";
                this.labelValue1 = "";
                this.labelValue2 = "";
                this.labelValue3 = "";
                this.labelValue4 = "";
                this.isLabel = false;
                this.isMask = false;
            },
            labelType () {
                const _data = {type: 'funzg_customer_type/' + tool.app.platformCode + '/' + tool.app.saasId}
                api_sell.sysDict(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.customerTypeList = data.params.dicts;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },
            labelLevel () {
                const _data = {type: 'funzg_customer_star/' + tool.app.platformCode + '/' + tool.app.saasId}
                api_sell.sysDict(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.levelList = data.params.dicts;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },
            labelClue () {
                const _data = {type: 'funzg_customer_project_type/' + tool.app.platformCode + '/' + tool.app.saasId}
                api_sell.sysDict(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.clueList = data.params.dicts;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },
            labelSort () {
                const _data = {type: 'funzg_customer_order/' + tool.app.platformCode + '/' + tool.app.saasId}
                api_sell.sysDict(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.sortList = data.params.dicts;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },
            orderStatusList () {
                const _data = {type: 'fun_order_status/' + tool.app.platformCode + '/' + tool.app.saasId}
                api_sell.sysDict(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.orderList = data.params.dicts;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },
            getCustomerSearchList () {
                const _data = {
                    saasId: tool.app.saasId,
                    agentUserId: "0003660579e611e9a021246e965b5bf8",//登录用户id
                    offset: "0",
                    limit: "10",
                    customerStatus: this.listStatus,//行销状态 1:待跟进；2：跟进中；3：计划跟进；4：待成交 5：被拉黑 ；6：已成交 ；7：已放弃
                    customerType: "1",//客户类型 1-系统分配;2-主动取数;3-自建客户
                    sort: "1",//排序 1-时间顺序 2-质量顺序，没选传空 即默认按时间
                }
                api_sell.getCustomerSearchList(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.customerList = data.result;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },

            goDetail (item) {
                this.$router.push({ path: '/customerDetail/' + item.clientId + '/' + item.clientNewId});
            },
            
            selectClick (type) {
                this.isLabel = true;
                // this.isMask = true;
                this.labelStatus = type;
                if (this.listStatus == 1) {
                    if(type==1){
                        this.labelList = this.customerTypeList;
                    }else if(type==2){
                        this.labelList = this.levelList;
                    }else if(type==3){
                        this.labelList = this.clueList;
                    }else if(type==4){
                        this.labelList = this.sortList;
                    }
                } else if (this.listStatus == 4) {
                    if(type==1){
                        this.labelList = this.customerTypeList;
                    }else if(type==2){
                        this.labelList = this.levelList;
                    }else if(type==3){
                        this.labelList = this.orderList;
                    }else if(type==4){
                        this.labelList = this.sortList;
                    }
                } else if (this.listStatus == 2 || this.listStatus == 3) {
                    if(type==1){
                        this.labelList = this.customerTypeList;
                    }else if(type==2){
                        this.labelList = this.levelList;
                    }else if(type==4){
                        this.labelList = this.sortList;
                    }
                }
                console.log('444',this.labelList)
            },

            selectContent (name, value, type) {
                this.labelValue = value;
                this.isMask = false;
                this.isLabel = false;
                if (type == 'funzg_customer_type') {
                    this.labelTitle1 = name;
                    this.labelValue1 = value;
                } else if (type == 'funzg_customer_star') {
                    this.labelTitle2 = name;
                    this.labelValue2 = value;
                } else if (type == 'funzg_customer_project_type') {
                    this.labelTitle3 = name;
                    this.labelValue3 = value;
                } else if (type == 'funzg_customer_order') {
                    this.labelTitle4 = name;
                    this.labelValue4 = value;
                }
                this.getCustomerList();
            },

            // 客户列表
            getCustomerList () {
                const _data = {
                    saasId: tool.app.saasId,
                    agentUserId: "0003660579e611e9a021246e965b5bf8",//登录用户id
                    customerStatus: this.listStatus,//行销状态 1:待跟进；2：跟进中；3：计划跟进；4：待成交 5：被拉黑 ；6：已成交 ；7：已放弃
                    offset: "0",
                    limit: "10",
                    getSource: this.labelValue1,//客户来源:1-分配客户;2-取数客户;3-自建客户
                    customerStar: this.labelValue2,//客户星级:1-5级
                    purchaseIntention: "",//专案线索,this.labelValue3
                    sort: this.labelValue4,//排序:1-时间顺序;2-客户等级
                    orderStatus: "10",//订单状态10-订单录入中、20-已取消、30-人工核保中、40-核保失败、50-未支付、60-支付完成、70-订单完成
                }
                api_sell.getCustomerList(_data).then(data => {
                    if (data.status == tool.rtCode.status) {
                        this.customerList = data.customerList;
                    } else {
                        tool.toastMessage(data.message, 'error');
                    }
                })
            },

            getCustomer () {
                this.accessStatus = true;
                this.isMask = true;
            },

            createCustomer () {
                this.$router.push({ path: '/createCustomer'});
            },

            search () {
                this.$router.push({ path: '/searchResult'});
            },

            closeAccess () {
                this.accessStatus = false;
                this.isMask = false;
                this.isLabel = false;
            },

            closed () {
                this.isMask = false;
                this.isLabel = false;
                this.accessStatus = false;
            },
            
            
            
        }
    }
</script>
<style scoped>
  
</style>