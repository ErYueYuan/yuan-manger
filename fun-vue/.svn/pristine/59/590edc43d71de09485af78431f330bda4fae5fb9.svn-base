<template>
  <div>
    <div class="fun-top-panel bg7  ">
      <span class="mess-back " @click="goBack"><div class="cont"></div></span>
      <span class="title c3 f3 dblock2 t-center ">选择发言人</span>
    </div>
    <div class="main-top p-fix bg7 b-radius2">
      <section class="f-flex pad7-1 border-b1">
        <div class="sear-bb ">
          <div class=" new-search ns clearfix">
            <section class="sear-c posi2 clearfix mar5">
              <form action="" class="input-search-form" id="search_from"  >
                <input type="search"  input autocomplete="off" placeholder="输入关键字搜索" class="f2 " >
              </form>
              <button class="sea-btn"><span class="gg-search" ></span></button>
            </section>
          </div>
        </div>
        <!--<div class="all-box t-center f2 c8 l-h2">-->
          <!--<div class="sel-pp5 all pro">&lt;!&ndash;active为选中状态&ndash;&gt;-->
            <!--<span>筛选</span><span class="triangle-b5 "></span>-->
          <!--</div>-->
        <!--</div>-->
      </section>
    </div>
    <div class="main-container mar4-6 clearfix">
      <section class="cus-list" v-for="(item, index) in initialsPyList.segs" :key="index">
        <div class="tit f3 t-left c4">{{item.initial}}</div>
        <div class="list bg7 border-b1 posi2" v-for="(it, ind) in item.data" :key="ind">
          <div class="img-box ">
            <img v-lazy="it.portraitUrl">
          </div>
          <h3 class="right-box f3 c6 ">{{it.nickname}}</h3>
          <div class="sel-b4 sb1">
            <label>
              <input type="checkbox" name="check" :value="it.wechatId" :checked="checkVal.indexOf(it.wechatId) !== -1" @click="changeCheckVal(it)"><b></b>
            </label>
          </div>
        </div>
      </section>
    </div>
    <div class="pad1">
      <span class="hx-bt3" @click="sendMessNext">下一步</span>
    </div>
  </div>
</template>

<script>
  import Vue from 'vue'
  import { Empty, Lazyload } from 'vant'
  import * as tool from '@/common/Tool'
  import DataSource from "@/common/DataSource";

  Vue.use(Empty).use(Lazyload, { lazyComponent: true })

  export default {
    name: "GroupChat",
    data () {
      return {
        checkVal: [],
        checkList: []
      }
    },
    props: {
      initialsPyList: {
        type: Object, //要求父组件数据传输类型
        required: true  //必传
      },
      QYWeChatId: {
        type: String,
        required: true
      }
    },
    beforeCreate: function() {
      document.getElementsByTagName("body")[0].className = "bg3";
    },
    mounted () {
      console.log(this.initialsPyList)
    },
    methods: {
      changeCheckVal (it) {
        let ind = this.checkVal.indexOf(it.wechatId)
        if (ind === -1) {
          this.checkVal.push(it.wechatId)
          this.checkList.push({
            weChatId: it.wechatId,
            nickName: it.nickname
          })
        } else {
          this.checkVal.splice(ind, 1)
          this.checkList.splice(ind, 1)
        }
      },
      sendMessNext () {
        if (this.checkList.length > 0) {
          DataSource.set('groupChat', this.checkList, 2)
          let parameter = 'messType=qyWx&wid=' + this.QYWeChatId + '&GCid=1' // GCid 群发
          this.$router.push({name: 'messWindow', params: {p: parameter}})
        } else {
          tool.toastMessage('请选择需要发送的好友', 'warn')
        }
      },
      goBack () {
        this.$emit('chooseFriendGroup')
      }
    },
    beforeDestroy: function() {
      document.body.removeAttribute("class", "bg3")
    },
  }
</script>

<style scoped>

</style>
