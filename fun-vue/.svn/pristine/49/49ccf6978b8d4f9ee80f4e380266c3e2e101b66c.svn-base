<template>
  <div class="bg7">
    <div class="fun-top-panel bg-my  ">
      <span
        class="mess-back "
        @click="$router.push({name:'userSetting'})"
      >
        <!--<div class="cont-wh"></div>-->
        <span
          class="fun-icon icon-setting"
          title="设置"
        ></span>
      </span>
      <span class="title c7 f4 dblock2 t-center ">我的</span>
    </div>
    <div class="main-container mar1 clearfix">
      <div class="my-n-txtbox ">
        <div
          class="top-one  clearfix"
          @click="$router.push({name:'myRecord'})"
        >
          <div class=" pad3 right-box posi2 c7 c-p">
            <h3 class=" f3 ">{{user.userInfo.name?user.userInfo.name:name}}<b title="编辑"></b>
            </h3>
            <div class="f2 c7 mar7-2">
              <b class="no"></b><span>工号：</span><span>{{user.userInfo.agentcode}}</span>
            </div>
            <div class=" f2 c7">
              <b class="company"></b><span>公司：</span><span>{{user.userInfo.deptName2}}</span>
            </div>
          </div>
          <div class="img-box posi2">
            <img
              v-if="this.headImg"
              :src="this.headImg"
              alt="pic"
            />
            <img
              v-if="!this.headImg"
              src="../../assets/img/index/bar_bg.png"
              alt="pic"
            />
            <h3 class="state f2 c-p">TSR</h3>
          </div>
        </div>
        <section class="my2020-nav-top bg7 ">
          <ul class=" f2 row">
            <li class="col-6 t-center ">
              <b class="f3 c6">{{clientNum}}人/￥{{customerCost}}</b>
              <div class="t-center f2 c5">客户/成本</div>
            </li>
            <li class="col-5 t-center none">
              <b class="f3 c6">￥0.0000</b>
              <div class="t-center f2 c5">钱包</div>
            </li>
          </ul>
        </section>
      </div>
      <div class="ek-com-tit5">我的获客工具<span
          class="f-right f2 c55 c-p"
          @click="$router.push({name:'qrcode'})"
        ><b class="b1"></b>设置二维码</span></div>
      <section class="pad1-3">
        <div class="bg7  b-sh1 new-nav-box tools">
          <ul class="clearfix">
            <li
              class="  f2 pad1"
              @click="$router.push({ name: 'articleList',params:{path:1} })"
            >
              <span class="one"></span>文章
            </li>
            <li class=" f2 pad1">
              <span class="two"></span>风险测评
            </li>
            <li class=" f2 pad1">
              <span class="three"></span>资产配置
            </li>
            <li
              class="f2 pad1"
              @click="$router.push({ name: 'productList' })"
            >
              <span class="four"></span>产品
            </li>
            <li
              class=" f2 pad1"
              @click="goProposal"
            >
              <span class="five"></span>计划书
            </li>
            <li class=" f2 pad1">
              <span class="six"></span>名片
            </li>
            <li
              class="f2 pad1"
              @click="goPost"
            >
              <span class="seven"></span>海报
            </li>
            <li
              class="f2 pad1"
              @click="goShop"
            >
              <span class="eight"></span>微店
            </li>
          </ul>
        </div>
      </section>

      <div class="ek-com-tit5 ">工作助手</div>
      <section class="pad1-3">
        <div class="bg7  b-sh1 new-nav-box tools">
          <ul class="clearfix">
            <li
              class="  f2 pad1"
              @click="$router.push({ name: 'marketing' })"
            >
              <span class="nine"></span>营销政策
            </li>
            <li class=" f2 pad1">
              <span class="ten"></span>收入结算
            </li>
            <li class=" f2 pad1">
              <span class="eleven"></span>继续率考核
            </li>
            <li
              class="f2 pad1"
              @click="$router.push({ name: 'coursesList' })"
            >
              <span class="twelve"></span>学习课堂
            </li>
            <li
              class=" f2 pad1"
              @click="$router.push({name:'repository'})"
            >
              <span class="fourteen"></span>知识库
            </li>
            <li
              class="f2 pad1"
              @click="$router.push({name: 'fastReply', params: {type: 'my'}})"
            >
              <span class="fifteen"></span>快捷回复
            </li>
            <li class="f2 pad1">
              <span class="sixteen"></span>意见反馈
            </li>
          </ul>
        </div>
      </section>
      <div class="ek-com-tit5 ">我的数据</div>
      <section class="pad1-3">
        <div class="bg7  b-sh1 new-nav-box tools">
          <ul class="clearfix pad1-3">
            <li
              class="  f2 pad1"
              @click="$router.push({name:'client'})"
            >
              <span class="seventeen"></span>我的客户
            </li>
            <li
              class=" f2 pad1"
              @click="$router.push({name:'performance'})"
            >
              <span class="eighteen"></span>我的业绩
            </li>
            <li class=" f2 pad1">
              <span class="nineteen"></span>我的收入
            </li>
          </ul>
        </div>
      </section>
    </div>
    <footer-panel footer="my"></footer-panel>
  </div>
</template>

<script>
import { mapGetters } from 'vuex'
import { FooterPanel } from '@/components/index'
import { api_my } from '@/api/index'
import * as tool from '@/common/Tool'
import DataSource from '@/common/DataSource'

export default {
  name: 'My',
  computed: {
    ...mapGetters(['user', 'userHead']),
  },
  data() {
    return {
      clientNum: '',
      customerCost: '',
      headImg: '',
      query: Object,
      name: '',
      userhead: ''
    }
  },
  components: {
    'footer-panel': FooterPanel
  },
  created() {
    let head = JSON.stringify(this.userHead)
    if (head == "{}") {
      this.userhead = head;
    }
    this.myProfileDetail()
  },
  mounted() {
    this.getCustomerCosts()
  },
  methods: {
    myProfileDetail() {
      let _data = {
        'userId': this.user.userInfo.userId,
        'saasId': this.user.userInfo.saasId
      }
      api_my.myProfileDetail(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.headImg = res.head
          this.name = res.name
          DataSource.set('record', res, 1)
        }
      })
    },
    goBack() {
      this.$router.go(-1)
    },
    goPost() {
      const channelUserId = this.user.userInfo.mobile || this.user.userInfo.agentcode,
        identificationStatus = this.user.userInfo.status || ''
      window.location.href = tool.app.lzgUrl + '#/source/channelUserId=' + channelUserId + '&opType=2&status=' + identificationStatus + '&platformId=' + tool.app.platformId + '&platformCode=' + tool.app.platformCode
    },
    goCard() {
      const channelUserId = this.user.userInfo.mobile || this.user.userInfo.agentcode,
        identificationStatus = this.user.userInfo.status || ''
      window.location.href = tool.app.lzgUrl + '#/source/channelUserId=' + channelUserId + '&opType=3&status=' + identificationStatus + '&platformId=' + tool.app.platformId + '&platformCode=' + tool.app.platformCode
    },
    goProposal() {
      const channelUserId = this.user.userInfo.mobile || this.user.userInfo.agentcode,
        identificationStatus = this.user.userInfo.status || ''
      window.location.href = tool.app.lzgUrl + '#/source/channelUserId=' + channelUserId + '&opType=1&status=' + identificationStatus + '&platformId=' + tool.app.platformId + '&platformCode=' + tool.app.platformCode
    },
    goShop() {
      const userId = this.user.userInfo.userId
      window.location.href = tool.app.channelUrl + '#/loginChannel/type=home&userId=' + userId
    },
    getCustomerCosts() {
      let _data = {
        'saasId': this.user.userInfo.saasId,
        'userId': this.user.userInfo.userId
      }
      api_my.getCustomerCost(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.clientNum = res.funCustomerCostDTO.clientNum
          this.customerCost = res.funCustomerCostDTO.customerCost
        } else {
          tool.toastMessage(res.message, 'error')
        }
      })

    },

  }
}
</script>

<style scoped>
</style>
