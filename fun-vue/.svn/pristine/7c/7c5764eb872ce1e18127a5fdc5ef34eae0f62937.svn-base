<template>
  <div>
    <van-popup v-model="popupVisible" round position="bottom" @click-overlay="handleAddressCancel">
      <van-picker
        show-toolbar
        :value-key="addressValueKey"
        :columns="addressSlots"
        @cancel="handleAddressCancel"
        @change="onAddressChange"
        @confirm="handleAddressSelect"
      ></van-picker>
    </van-popup>
  </div>
</template>

<script>
  import Vue from 'vue'
  import provinceCityData from '@/static/json/city.json'
  import { Popup, Picker } from 'vant'
  Vue.use(Popup)
  Vue.use(Picker)

  export default {
    name: "ProvinceCity",
    data () {
      return {
        popupVisible: true,
        clickFalse: false,
        addressValueKey: 'areaName',
        address: [],
        addressSlots: [
          {
            flex: 1,
            values: provinceCityData.address,
            className: 'slot1',
            textAlign: 'center'
          }, {
            flex: 1,
            values: provinceCityData.address[0].areaList,
            className: 'slot3',
            textAlign: 'center'
          }
        ],
        addressProvince: '',
        addressCity: '',
      }
    },
    props: {
      provinceCityIndex: String
    },
    methods: {
      onAddressChange(picker, values) {
        if (values[0] && values[0].areaList) {
          picker.setColumnValues(1, values[0].areaList);
          this.addressProvince = values[0];
          this.addressCity = values[1];
        }
      },
      handleAddressCancel () {
        this.$emit('provinceCityData')
      },
      handleAddressSelect (values, index) {
        let params = {
          provinceName: values[0].areaName,
          provinceCode: values[0].areaCode,
          cityName: values[1].areaName,
          cityCode: values[1].areaCode,
          addressType: this.provinceCityIndex
        }
        this.$emit('provinceCityData', params)
      },
    }
  }
</script>

<style scoped>

</style>
