<template>
  <div class="bg3">
    <div class="fun-top-panel bg7 ">
      <span
        class="mess-back "
        @click="goBack()"
      >
        <div class="cont"></div>
      </span>
      <span class="title c3 f3 dblock2 t-center ">知识库</span>
    </div>
    <div class="main-top p-fix bg7 b-radius2">
      <section class="f-flex  border-b1">
        <div class="sear-bb ">
          <div class=" new-search ns2 clearfix">
            <section class="sear-c posi2 clearfix">
              <form
                action=""
                class="input-search-form"
                id="search_from"
              >
                <van-search
                  v-model="searchval"
                  shape="round"
                  background=""
                  placeholder="请输入搜索关键词"
                  @search="onSearch"
                />
              </form>
            </section>
          </div>
        </div>
      </section>
    </div>
    <div class="main-container mar4-5 bg7 bot1 clearfix">
      <section class="tab-box3">
        <span
          class="c-p"
          v-for="(item,index) in tagList"
          :key="index"
          :class="tabnum == item.id?'active':''"
          @click="getBtn(item.id)"
        >{{item.name}}</span>
      </section>
      <section>
        <van-collapse
          v-model="activeName"
          accordion
        >
          <van-collapse-item
            v-for="(item,index) in lmKnowledgeList"
            :key="index"
            :title="item.knowledgeId+'. '+item.title"
            :name="item.id"
          >
            <!-- @click.native="getKnowledgeClassList('0')" -->
            <van-collapse
              v-model="chiildName"
              accordion
            >
              <van-collapse-item
                v-for="(item,index) in list"
                :key="index"
                :title="index+1+'. '+item.className"
                :name="item.id"
              >
                <!-- @click.native="getKnowledgeClassList('0')" -->
                <van-collapse accordion>
                  <van-collapse-item
                    v-for="(item,index) in list"
                    :key="index"
                    :title="index+1+'. '+item.className"
                    :name="item.id"
                    @click.native="$router.push({path:'/repositorydetails/'+'11111'})"
                  >
                  </van-collapse-item>
                </van-collapse>
              </van-collapse-item>
            </van-collapse>
          </van-collapse-item>
        </van-collapse>
      </section>
    </div>
    <!-- <div class="t-center f3 c6 pad6">未找到答案？<span class="c8">去提问</span></div> -->
  </div>
</template>

<script>
import Vue from 'vue'
import { mapGetters } from 'vuex'
import { api_my } from '@/api/index'
import * as tool from '@/common/Tool'
import { Collapse, CollapseItem, Search, Button } from 'vant';

Vue.use(Collapse);
Vue.use(Button);
Vue.use(CollapseItem);
Vue.use(Search);
export default {
  data() {
    return {
      tabnum: 1,
      searchval: '',
      activeName: '1',
      chiildName: '1',
      chiildwName: '1',
      list: [],
      tagList: [],
      lmKnowledgeList: []
    }
  },
  computed: {
    ...mapGetters(['user']),
  },
  created() {
    this.getKnowledgeClassList();
    this.getKnowledgeTitle();
    this.getDefaultLabelList();
    this.getKnowledgeListByLabel();
  },
  methods: {
    goBack() {
      this.$router.go(-1)
    },
    chag(val) {
      console.log(val);
    },
    getBtn(num) {
      this.tabnum = num;
      this.getKnowledgeTitle();
    },
    getKnowledgeClassList(val) {
      let _data = {
        "platformId": "f2ce8561055a40d5a5e7dcdffde1e8bc",
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "classLevel": 1,
        "parentId": val
      }
      api_my.getKnowledgeClassList(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.list = res.knowledgeClassList
        } else {
          tool.toastMessage(res.message, 'error');

        }
      })
    },
    getKnowledgeTitle() {
      let _data = {
        "platformId": "f2ce8561055a40d5a5e7dcdffde1e8bc",
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        // "classId":this.tabnum,
        "classId": 7
      }
      api_my.getKnowledgeTitle(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.lmKnowledgeList = res.lmKnowledgeList
        } else {
          tool.toastMessage(res.message, 'error');
        }
      })
    },
    getDefaultLabelList() {
      let _data = {
        saasId: "ff5a67337b6611e89feafa163eb3e537"
      }
      api_my.getDefaultLabelList(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.tagList = res.lmKnowledgeDefaultLabelList
        } else {
          tool.toastMessage(res.message, 'error');
        }
      })
    },
    getKnowledgeListByLabel() {
      let _data = {
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "search": "华为",
        statusName: 0,
        "title": this.searchval,
        createUser: 'admin'
      }
      api_my.getKnowledgeListByLabel(_data).then(res => {
        console.log(res);
      })
    },
    onSearch() {
      this.getKnowledgeListByLabel();
    }
  },
}
</script>

<style>
</style>