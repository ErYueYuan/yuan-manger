<template>
  <div class="bg7">
    <div class="fun-top-panel bg7 ">
      <span class="mess-back ">
        <div
          class="cont"
          @click="goBack"
        ></div>
      </span>
      <span class="title c3 f3 dblock2 t-center ">我的业绩</span>
    </div>
    <div class="main-container mar1 clearfix">
      <div class="index-top4">
        <h3 class="ek-com-tit2 c6 f3">业绩走势
          <span class="f-right dblock">
            <van-button
              :type="type==1?'danger':'default'"
              plain
              size="mini"
              @click="type=1,getAchieveTrend()"
            >标保</van-button>
            <van-button
              :type="type==2?'danger':'default'"
              plain
              size="mini"
              @click="type=2,getAchieveTrend()"
            >保费</van-button>
            <van-button
              :type="type==3?'danger':'default'"
              plain
              size="mini"
              @click="type=3,getAchieveTrend()"
            >推广费</van-button>
          </span>
        </h3>
        <!-- <div class="c6 f2 pad4-1">客户进展</div> -->
        <!-- <div><img src="@/assets/img/index/chart1.png" /></div> -->
        <div
          style="height:250px;width:100%;"
          ref="perEchart"
        ></div>
        <div class="more-box f2 c4 t-center c-p">
          <!-- <b></b>查看更多 -->
        </div>
      </div>
      <div class="index-top4">
        <h3 class="ek-com-tit2 c6 f3">业绩查询  <span class="f-right dblock">
            <van-button
              :type="datetype=='M'?'danger':'default'"
              plain
              size="mini"
              @click="datetype='M',getSameDayTarget(),getPremAchieve()"
            >本月</van-button>
            <van-button
              :type="datetype=='D'?'danger':'default'"
              plain
              size="mini"
              @click="datetype='D',getSameDayTarget(),getPremAchieve()"
            >今日</van-button>
          </span></h3>
        <div class="bg4 b-radius3 message-box mar7-1">
          <ul class="mar6-4 pad6-1 border-b">
            <li>
              <h3 class="f3 c5 c4 t-center">{{ sameDayTarget || 0}}</h3>
              <div class="t-center f1 ">新增标保</div>
              <div class="t-center f1 ">(万元)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{sameDayPrem|| 0}}</h3>
              <div class="t-center f1 ">新增保费</div>
              <div class="t-center f1 ">(万元)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{ policy|| 0}}</h3>
              <div class="t-center f1 ">新增保单</div>
              <div class="t-center f1 ">(份)</div>

            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{extension || 0}}</h3>
              <div class="t-center f1 ">预计佣金</div>
              <div class="t-center f1 ">(元)</div>
            </li>
          </ul>
        </div>
        <div class="bg4 b-radius3 message-box mar7-1">
            <div class="border-b1" >
          <div class="border-b1 f1-2 pad5-3">2020-10-10</div>
          <strong class="f2-1 pad5-3">产品名称</strong>
          <ul class="mar6-4 pad6-1 border-b">
            <li>
              <h3 class="f3 c5 c4 t-center">{{MessageChat.sendMessage || 0}}</h3>
              <div class="t-center f1 ">投保人</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{MessageChat.paidPrem || 0}}</h3>
              <div class="t-center f1 ">保费(万元)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{MessageChat.standPrem || 0}}</h3>
              <div class="t-center f1 ">标保(份)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{MessageChat.spreadPrem || 0}}</h3>
              <div class="t-center f1 ">推广费(元)</div>
            </li>
          </ul>
         </div>
         <!-- <div class="border-b1" v-for="(item,index) in list" :key="index">
          <div class="border-b1 f1-2 pad5-3">{{item.orderDate}}</div>
          <strong class="f2-1 pad5-3">{{item.productName}}</strong>
          <ul class="mar6-4 pad6-1 border-b">
            <li>
              <h3 class="f3 c5 c4 t-center">{{item.holderName}}</h3>
              <div class="t-center f1 ">投保人</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{item.paidPrem || 0}}</h3>
              <div class="t-center f1 ">保费(万元)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{item.standPrem || 0}}</h3>
              <div class="t-center f1 ">标保(份)</div>
            </li>
            <li>
              <h3 class="f3 c5 c4 t-center">{{item.spreadPrem || 0}}</h3>
              <div class="t-center f1 ">推广费(元)</div>
            </li>
          </ul>
         </div> -->
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import Vue from 'vue'
import { api_my } from '@/api/index'
import { mapGetters } from 'vuex'
import * as tool from '@/common/Tool'
import echarts from 'echarts'
import { Button } from 'vant';
Vue.use(Button)
export default {
  name: 'performance',
  computed: {
    ...mapGetters(['user'])
  },
  data() {
    return {
      MessageChat: {},
      monthStatistics: {},
      type: 1,
      policy: '',
      sameDayTarget: '',
      extension: '',
      sameDayPrem: '',
      achieveData: '',
      list:'',
      datetype:'M'
    }
  },
  components: {

  },
  created() {
    this.getAchieveTrend();
    this.getSameDayTarget();
    this.getPremAchieve()
  },
  mounted() {
    this.$nextTick(function () {
      this.initChart();
    });

  },
  methods: {
    goBack() {
      this.$router.go(-1);
    },
    getAchieveTrend() {
      let _data = {
        "agentCode": 1002,
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "premType": this.type,//1:标保，2:保费,3:推广费
      }
      api_my.getAchieveTrend(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.achieveData = res.achieveData
          // {paidPrem: [], orderDate: []}
        }
      })
    },
    getSameDayTarget() {
      let _data = {
        "agentCode": 9999,
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "dateFlag": this.datetype
      }
      api_my.getSameDayTarget(_data).then(res => {
        if (res.status == tool.rtCode.status) {
          this.policy = res.policy
          this.sameDayTarget = res.sameDayTarget
          this.extension = res.extension
          this.sameDayPrem = res.sameDayPrem
        } else {
          tool.toastMessage(res.message, 'error')
        }

      })
    },
    getPremAchieve() {
      let _data = {
        "agentCode": 1002,
        "saasId": "ff5a67337b6611e89feafa163eb3e537",
        "startDate": "2020-09"
      }
      api_my.getPremAchieve(_data).then(res=>{
        if(res.status == tool.rtCode.status){
            this.list = res.funUserPremDTOList
        }else {
            tool.toastMessage(res.message, 'error')
        }
      })
    },
    initChart() {
      const chart = echarts.init(this.$refs.perEchart)
      chart.clear() //清除旧数据
      chart.setOption({
        title: {
          text: '',
          subtext: '单位：万元',
        },
        tooltip: {
          show: false
        },
        xAxis: {
          data: ["1月", "2月", "3月", '4月', '5月']
        },
        yAxis: {
          type: 'value'
        },
        series: [
          {
            type: 'bar',
            data: [1, 5, 10, 4, 7],
            itemStyle: {
              normal: {
                color: '#FF9300',
                barBorderRadius: [5, 5, 0, 0],
                label: {
                  show: true, //开启显示
                  position: 'top', //在上方显示
                  textStyle: { //数值样式
                    fontSize: 13
                  }
                }
              }
            },
          },
        ]
      }
      )
    }

  }
}
</script>

<style>
</style>