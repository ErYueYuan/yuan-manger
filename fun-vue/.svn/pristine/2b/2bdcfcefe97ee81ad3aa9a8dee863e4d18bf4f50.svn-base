<template>
  <div class="bg3" style="padding-bottom: 100%;">
    <div class="fun-top-panel bg7 border-b1">
      <span
        class="mess-back "
        @click="goBack"
      >
        <div class="cont"></div>
      </span>
      <span class="title c33 f4 dblock2 t-center ">修改密码</span>
    </div>
    <div class="mar1 clearfix pass">
      <div class="login-box modify clearfix" style="padding:0;">
        <section class="login-info-box reg">
          <van-field
            v-model="oldPass"
            label="旧密码"
            placeholder="请输入旧密码"
            input-align="right"
          />
          <van-field
            v-model="newPass"
            label="新密码"
            placeholder="请输入新密码"
            input-align="right"
          />
          <van-field
            v-model="newVal"
            label="确认新密码"
            placeholder="请确认新密码"
            input-align="right"
          />
        </section>

      </div>
      <div class="pad5-1">
        <button
          type="button"
          class="hx-bt3 t-center"
          @click="ecloudRetrievePassword"
        >立即修改</button>
      </div>
    </div>
  </div>
</template>

<script>
import Vue from 'vue'
import { mapGetters } from 'vuex'
import { api_my } from '@/api/index'
import { Form, Field } from 'vant';
import * as tool from '@/common/Tool'
import Vd from '@/common/Validator'


Vue.use(Form)
Vue.use(Field)
export default {
  computed: {
    ...mapGetters(['user']),
  },
  data() {
    return {
      oldPass: '',
      newPass: '',
      newVal: ''
    }
  },
  components: {

  },
  mounted() {

  },
  methods: {
    goBack() {
      this.$router.go(-1)
    },
    ecloudRetrievePassword() {
      if (
        Vd.required(this.oldPass, '请输入旧密码')
        && Vd.required(this.newPass, '请输入新密码')&&Vd.required(this.newVal,'请再次输入新密码')) {
        if(this.newPass == this.newVal){
          const _data = {
            mobile:this.user.userInfo.mobile,
            saasId: tool.app.saasId,
            platformCode: tool.app.platformCode,
            oldPassword: this.oldPass,
            password: this.newPass
          }
          api_my.ecloudRetrievePassword(_data).then(data => {
            if (data.status == tool.rtCode.status) {
              tool.toastMessage('恭喜您，修改密码成功，请重新登录')
              this.$router.push({ path: '/login' })
            } else {
              tool.toastMessage(data.message, 'error')
            }
          })
        }else {
              tool.toastMessage('两次新密码不一致', 'error')
        }
      }
    }
  }
}
</script>
<style scoped>
html,
body,
#api,
.bg3 {
  height: 100%!important;
}
</style>
