<template>
  <div>
    <div class="index-top4">
      <h3 class="ek-com-tit2 c6 f3">昨日业绩</h3>
      <div class="  message-box5 mar7-1">
        <ul class="b-radius3 bg4 ">
          <li class=" pad6-1 f2  ">
            <span class="sp1 f3 c5">{{yesterdayDate.sameDayTarget || 0}}</span>
            <span class="f1 c4">新增标保</span>
            <span class=" f1-1 c4 ">(万元)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{yesterdayDate.sameDayPrem || 0}}</span>
            <span class="f1 c4">新增保费</span>
            <span class=" f1-1 c4 ">(万元)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{yesterdayDate.policy || 0}}</span>
            <span class="f1 c4">新增保单</span>
            <span class=" f1-1 c4 ">(份)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{yesterdayDate.extension || 0}}</span>
            <span class="f1 c4">预计佣金</span>
            <span class=" f1-1 c4 ">(元)</span>
          </li>
        </ul>
      </div>
    </div>
    <div class="index-top4">
      <h3 class="ek-com-tit2 c6 f3">本月业绩<span class="c5 f1 f-right c-p">累计到 {{time}}</span></h3>
      <div class="  message-box5 mar7-1">
        <ul class="b-radius3 bg4 ">
          <li class=" pad6-1 f2  ">
            <span class="sp1 f3 c5">{{monthDate.sameDayTarget || 0}}</span>
            <span class="f1 c4">新增标保</span>
            <span class=" f1-1 c4 ">(万元)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{monthDate.sameDayPrem || 0}}</span>
            <span class="f1 c4">新增保费</span>
            <span class=" f1-1 c4 ">(万元)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{monthDate.policy || 0}}</span>
            <span class="f1 c4">新增保单</span>
            <span class=" f1-1 c4 ">(份)</span>
          </li>
          <li class="b-radius3 pad6-1 f2 mar7-2 bg4">
            <span class="sp1 f3 c5">{{monthDate.extension || 0}}</span>
            <span class="f1 c4">预计佣金</span>
            <span class=" f1-1 c4 ">(元)</span>
          </li>
        </ul>
      </div>
      <div style="height: 130px;">
        <div style="height:130px;width:35%;float: left;" ref="performEchart"></div>
        <div class="charts-text" >
          <ul>
            <li v-for="(item, index) in pieData" :key="index">
              <span class="text-name"><b :class="'b'+index"></b>{{item.name}}</span>
              <span class="text-rate">{{item.value + '%'}}</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="more-box2 t-center c-p" @click="$router.push({name:'performance'})">更多业绩详情</div>
    </div>
  </div>
</template>

<script>
  import { mapGetters } from 'vuex'
  import * as tool from '@/common/Tool'
  import { api_user } from '@/api/index'
  import echarts from 'echarts'

  export default {
    name: "Performance",
    data () {
      return {
        yesterdayDate: {},
        monthDate: {},
        time: '',
        pieData: []
      }
    },
    computed: {
      ...mapGetters(['user']),
    },
    created () {
      this.getYesterdayData() // 昨日业绩
      this.getMonthData() // 当月业绩
      this.getAchievement() //本月业绩环状图查询
    },
    mounted () {
      this.getTime()
    },
    methods: {
      getTime () {
        const newDate = new Date(),
          year = newDate.getFullYear(),
          month = newDate.getMonth() + 1,
          day = newDate.getDate()
        this.time = year + '-' + month + '-' + day
      },
      getYesterdayData () {
        const _data = {
          saasId: tool.app.saasId,
          agentCode: this.user.userInfo && this.user.userInfo.agentcode ? this.user.userInfo.agentcode : '',
          dateFlag: 'D'
        }
        api_user.getSameDayTarget(_data).then(data => {
          if (data.status === tool.rtCode.status) {
            this.yesterdayDate = data
          } else {
            tool.toastMessage(data.message, 'error')
          }
        })
      },
      getMonthData () {
        const _data = {
          saasId: tool.app.saasId,
          agentCode: this.user.userInfo && this.user.userInfo.agentcode ? this.user.userInfo.agentcode : '',
          dateFlag: 'M'
        }
        api_user.getSameDayTarget(_data).then(data => {
          if (data.status === tool.rtCode.status) {
            this.monthDate = data
          } else {
            tool.toastMessage(data.message, 'error')
          }
        })
      },
      getAchievement () {
        const _data = {
          agentCode: this.user.userInfo.agentcode || '',
          saasId: tool.app.saasId,
          flag: 'L'
        }
        api_user.getAchievement(_data).then(data => {
          if (data.status === tool.rtCode.status) {
            let achievementData = data.result
            for (let it of achievementData) {
              if (it && it.rate) {
                this.pieData.push({
                  name: it.name,
                  value: it.rate
                })
              }
            }
            this.pieData.push({
              name: '其他',
              value: 0
            })
            this.initChart(this.pieData)
          }
        })
      },
      initChart(data) {
        this.chart = echarts.init(this.$refs.performEchart);
        let color = ["#73a0fa", "#73deb3", "#7585a2", "#f7c739", "#eb7e65"]
        this.chart.setOption({
          backgroundColor: '#ffffff',
          series: [
            {
              type: 'pie',
              radius: ['60%', '90%'],
              hoverAnimation: false,
              legendHoverLink: false,
              data: data,
              label: {
                show: false
              }
            }
          ],
          color: color
        });
      }
    }
  }
</script>

<style scoped>
  .charts-text{height:130px;width:65%;float: left;background: #fff;padding-left: 6px;}
  .charts-text ul{margin-top:20px;}
  .charts-text ul li{font-size: 12px; color: #9b9b9b;line-height: 20px;}
  .charts-text ul li span.text-name{display:inline-block; width: 70%;}
  .charts-text ul li .text-name b{display: inline-block;width: 8px;height: 8px;border-radius: 4px;margin: 0 3px;}
  .charts-text ul li .text-name b.b0{background: #73a0fa;}
  .charts-text ul li .text-name b.b1{background: #73deb3;}
  .charts-text ul li .text-name b.b2{background: #7585a2;}
  .charts-text ul li .text-name b.b3{background: #f7c739;}
  .charts-text ul li .text-name b.b4{background: #eb7e65;}
  .charts-text ul li .text-rate{display:inline-block; width: 30%;text-align: right;}
</style>
